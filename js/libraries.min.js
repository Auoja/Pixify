!function(t){function i(t,i,e,o){this._h=t||0,this._s=i||0,this._l=e||0,this._a=o||1}function e(t,i,e,o){this._r=t,this._g=i,this._b=e,this._a=o}function o(t,i,o){this._context=t,this._width=i,this._height=o,this._imageData=this._context.createImageData(this._width,this._height),this._xPos=0,this._yPos=0,this._color=new e(0,0,0,1)}function s(t){function i(t){m=t%2===0?t:t-1||32,c=m,g=2*m-1,f=m/2,u=m+y}function s(t){y=t%2===0?t:t-1||0,u=m+y}function h(t){r=document.createElement("canvas"),_=r.getContext("2d"),l=t.width,d=t.height,r.width=l,r.height=d,_.drawImage(t,0,0,l,d)}function a(t){var i=t.getHash();if(!P[i]){var e=null;if(0!==t._a){var o=t.getHSL();e={normalSide:t,darkSide:o.darken(30).getRGB(),darkestSide:o.darken(60).getRGB(),highlight:o.lighten(30).getRGB(),cornerHighlight:o.lighten(80).getRGB(),outline:o.darken(90).getRGB()}}P[i]=e}return P[i]}function n(t,i,e){var o=a(e);if(null!==o){S.setColor("left"===x?o.darkSide:o.darkestSide);for(var s=1;c>s;s++)S.moveTo(t,i+s-c),S.drawSlantedLineDown(m);for(S.setColor("left"===x?o.darkestSide:o.darkSide),s=1;c>s;s++)S.moveTo(t+m-1,i+f-1+s-c),S.drawSlantedLineUp(m);for(S.setColor(o.normalSide),s=1;m-1>s;s++)S.moveTo(t+2*s,i-c),S.drawSlantedLineUp(m-s-1),S.moveTo(t+2*s,i-c),S.drawSlantedLineDown(m-s-1);S.setColor(o.outline),S.moveTo(t,i),S.drawSlantedLineDown(m),S.moveRelativeTo(-1,-1),S.drawSlantedLineUp(m),S.moveTo(t,i-c),S.drawVerticalLine(c),S.moveTo(t+g-1,i-c),S.drawVerticalLine(c),S.moveTo(t,i-c),S.drawSlantedLineUp(m),S.moveRelativeTo(-1,1),S.drawSlantedLineDown(m),S.setColor(o.highlight),S.moveTo(t+2,i-c+1),S.drawSlantedLineDown(m-2),S.moveRelativeTo(-1,-1),S.drawSlantedLineUp(m-2),S.moveTo(t+m-1,i+f-1-c),S.drawVerticalLine(c),S.setColor(o.cornerHighlight),S.moveTo(t+m-1,i+f-1-c),S.drawVerticalLine(3),S.moveTo(t+m-2,i+f-1-c),S.drawHorizontalLine(3)}}var r,_,l,d,c,g,f,u,w=t.canvas,v=w.getContext("2d"),P={},p=10,x="left",m=32,y=0;i(t.pixelSide),s(t.pixelGap),h(t.image);var S;this.setPixelSize=function(t){i(t)},this.setPixelGap=function(t){s(t)},this.setSunPosition=function(t){x=t},this.renderHorizontal=function(){w.width=2*p+m*(l+d-2)+y*(l+d-2)+g,w.height=2*p+f*(l+d)+y/2*(l+d-2)+c,S=new o(v,w.width,w.height);for(var t={x:p,y:p+l*f+y/2*(l-1)+c},i=0;d>i;i++)for(var s=l-1;s>=0;s--){var h=_.getImageData(s,i,1,1).data;n(t.x+(s+i)*u,t.y+(.5*i-.5*s)*u,new e(h[0]/255,h[1]/255,h[2]/255,h[3]/255))}S.render()},this.renderVertical=function(){w.width=2*p+m*(l-1)+y*(l-1)+g,w.height=2*p+f*(l+1)+y/2*(l-1)+c*d+y*(d-1)-1,S=new o(v,w.width,w.height);for(var t={x:p,y:p+l*f+y/2*(l-1)+c},i=d-1;i>=0;i--)for(var s=l-1;s>=0;s--){var h=_.getImageData(s,i,1,1).data;n(t.x+s*u,t.y+(i-.5*s)*u,new e(h[0]/255,h[1]/255,h[2]/255,h[3]/255))}S.render()}}i.prototype.darken=function(t){return new i(this._h,this._s,this._l*(1-t/100),1)},i.prototype.lighten=function(t){return new i(this._h,this._s,this._l*(1+t/100),1)},i.prototype.getRGB=function(){function t(t,i,e){return 0>e&&(e+=1),e>1&&(e-=1),1/6>e?t+6*(i-t)*e:.5>e?i:2/3>e?t+(i-t)*(2/3-e)*6:t}var i,o,s;if(0===this._s)i=o=s=this._l;else{var h=this._l<.5?this._l*(1+this._s):this._l+this._s-this._l*this._s,a=2*this._l-h;i=t(a,h,this._h+1/3),o=t(a,h,this._h),s=t(a,h,this._h-1/3)}return new e(i,o,s,1)},e.prototype.getHSL=function(){var t,e,o=Math.max(this._r,this._g,this._b),s=Math.min(this._r,this._g,this._b),h=(o+s)/2;if(o===s)t=e=0;else{var a=o-s;switch(e=h>.5?a/(2-o-s):a/(o+s),o){case this._r:t=(this._g-this._b)/a+(this._g<this._b?6:0);break;case this._g:t=(this._b-this._r)/a+2;break;case this._b:t=(this._r-this._g)/a+4}t/=6}return new i(t,e,h,1)},e.prototype.getHash=function(){return this._r+"-"+this._g+"-"+this._b+"-"+this._a},o.prototype.flush=function(){this._imageData=this._context.createImageData(this._width,this._height)},o.prototype.moveTo=function(t,i){this._xPos=t,this._yPos=i},o.prototype.moveRelativeTo=function(t,i){this._xPos+=t,this._yPos+=i},o.prototype.setColor=function(t){this._color=t},o.prototype.setPixel=function(t,i,e){if(t>=0&&t<this._width&&i>=0&&i<this._height){var o=4*(t+i*this._imageData.width);this._imageData.data[o+0]=Math.round(255*e._r),this._imageData.data[o+1]=Math.round(255*e._g),this._imageData.data[o+2]=Math.round(255*e._b),this._imageData.data[o+3]=Math.round(255*e._a)}},o.prototype.drawSlantedLineUp=function(t){for(var i=this._xPos;this._xPos<i+t;)this.setPixel(this._xPos,this._yPos,this._color),this.setPixel(this._xPos+1,this._yPos,this._color),this._yPos--,this._xPos+=2},o.prototype.drawSlantedLineDown=function(t){for(var i=this._xPos;this._xPos<i+t;)this.setPixel(this._xPos,this._yPos,this._color),this.setPixel(this._xPos+1,this._yPos,this._color),this._yPos++,this._xPos+=2},o.prototype.drawVerticalLine=function(t){for(var i=this._yPos;this._yPos<i+t;)this.setPixel(this._xPos,this._yPos,this._color),this._yPos++},o.prototype.drawHorizontalLine=function(t){for(var i=this._xPos;this._xPos<i+t;)this.setPixel(this._xPos,this._yPos,this._color),this._xPos++},o.prototype.render=function(){this._context.putImageData(this._imageData,0,0)},t.Pixify=s}(this);