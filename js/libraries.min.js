!function(t){function i(t,i,e,o){this._h=t||0,this._s=i||0,this._l=e||0,this._a=o||1}function e(t,i,e,o){this._r=t,this._g=i,this._b=e,this._a=o}function o(t,i,o){this._context=t,this._width=i,this._height=o,this._imageData=this._context.createImageData(this._width,this._height),this._xPos=0,this._yPos=0,this._color=new e(0,0,0,1)}function s(){this._colorLUT={}}function h(t){function i(t){P=t%2===0?t:t-1||32,c=P,g=2*P-1,f=P/2,u=P+m}function h(t){m=t%2===0?t:t-1||0,u=P+m}function a(t){n=document.createElement("canvas"),_=n.getContext("2d"),d=t.width,l=t.height,n.width=d,n.height=l,_.drawImage(t,0,0,d,l)}function r(t,i,e){var o=y.getPalette(e);if(null!==o){x.setColor(o[v.leftSide]);for(var s=1;c>s;s++)x.moveTo(t,i+s-c),x.drawSlantedLineDown(P);for(x.setColor(o[v.rightSide]),s=1;c>s;s++)x.moveTo(t+P-1,i+f-1+s-c),x.drawSlantedLineUp(P);for(x.setColor(o[v.topSide]),s=1;P-1>s;s++)x.moveTo(t+2*s,i-c),x.drawSlantedLineUp(P-s-1),x.moveTo(t+2*s,i-c),x.drawSlantedLineDown(P-s-1);x.setColor(o.outline),x.moveTo(t,i),x.drawSlantedLineDown(P),x.moveRelativeTo(-1,-1),x.drawSlantedLineUp(P),x.moveTo(t,i-c),x.drawVerticalLine(c),x.moveTo(t+g-1,i-c),x.drawVerticalLine(c),x.moveTo(t,i-c),x.drawSlantedLineUp(P),x.moveRelativeTo(-1,1),x.drawSlantedLineDown(P),x.setColor(o.highlight),x.moveTo(t+2,i-c+1),x.drawSlantedLineDown(P-2),x.moveRelativeTo(-1,-1),x.drawSlantedLineUp(P-2),x.moveTo(t+P-1,i+f-1-c),x.drawVerticalLine(c),x.setColor(o.cornerHighlight),x.moveTo(t+P-1,i+f-1-c),x.drawVerticalLine(3),x.moveTo(t+P-2,i+f-1-c),x.drawHorizontalLine(3)}}var n,_,d,l,c,g,f,u,S=t.canvas,p=S.getContext("2d"),w=10,v={topSide:"normalSide",leftSide:"darkSide",rightSide:"darkestSide"},P=32,m=0;i(t.pixelSide),h(t.pixelGap),a(t.image);var x,y=new s;this.setPixelSize=function(t){i(t)},this.setPixelGap=function(t){h(t)},this.setSunPosition=function(t){var i=t;switch(i){case"left":v={topSide:"darkSide",leftSide:"normalSide",rightSide:"darkestSide"};break;case"right":v={topSide:"darkSide",leftSide:"darkestSide",rightSide:"normalSide"};break;case"top-right":v={topSide:"normalSide",leftSide:"darkestSide",rightSide:"darkSide"};break;case"top-left":default:v={topSide:"normalSide",leftSide:"darkSide",rightSide:"darkestSide"}}return v},this.renderHorizontal=function(){S.width=2*w+P*(d+l-2)+m*(d+l-2)+g,S.height=2*w+f*(d+l)+m/2*(d+l-2)+c,x=new o(p,S.width,S.height);for(var t={x:w,y:w+d*f+m/2*(d-1)+c},i=0;l>i;i++)for(var s=d-1;s>=0;s--){var h=_.getImageData(s,i,1,1).data;r(t.x+(s+i)*u,t.y+(.5*i-.5*s)*u,new e(h[0]/255,h[1]/255,h[2]/255,h[3]/255))}x.render()},this.renderVertical=function(){S.width=2*w+P*(d-1)+m*(d-1)+g,S.height=2*w+f*(d+1)+m/2*(d-1)+c*l+m*(l-1)-1,x=new o(p,S.width,S.height);for(var t={x:w,y:w+d*f+m/2*(d-1)+c},i=l-1;i>=0;i--)for(var s=d-1;s>=0;s--){var h=_.getImageData(s,i,1,1).data;r(t.x+s*u,t.y+(i-.5*s)*u,new e(h[0]/255,h[1]/255,h[2]/255,h[3]/255))}x.render()}}i.prototype.darken=function(t){return new i(this._h,this._s,this._l*(1-t/100),1)},i.prototype.lighten=function(t){return new i(this._h,this._s,this._l*(1+t/100),1)},i.prototype.getRGB=function(){function t(t,i,e){return 0>e&&(e+=1),e>1&&(e-=1),1/6>e?t+6*(i-t)*e:.5>e?i:2/3>e?t+(i-t)*(2/3-e)*6:t}var i,o,s;if(0===this._s)i=o=s=this._l;else{var h=this._l<.5?this._l*(1+this._s):this._l+this._s-this._l*this._s,a=2*this._l-h;i=t(a,h,this._h+1/3),o=t(a,h,this._h),s=t(a,h,this._h-1/3)}return new e(i,o,s,1)},e.prototype.getHSL=function(){var t,e,o=Math.max(this._r,this._g,this._b),s=Math.min(this._r,this._g,this._b),h=(o+s)/2;if(o===s)t=e=0;else{var a=o-s;switch(e=h>.5?a/(2-o-s):a/(o+s),o){case this._r:t=(this._g-this._b)/a+(this._g<this._b?6:0);break;case this._g:t=(this._b-this._r)/a+2;break;case this._b:t=(this._r-this._g)/a+4}t/=6}return new i(t,e,h,1)},e.prototype.getHash=function(){return this._r+"-"+this._g+"-"+this._b+"-"+this._a},o.prototype.flush=function(){this._imageData=this._context.createImageData(this._width,this._height)},o.prototype.moveTo=function(t,i){this._xPos=t,this._yPos=i},o.prototype.moveRelativeTo=function(t,i){this._xPos+=t,this._yPos+=i},o.prototype.setColor=function(t){this._color=t},o.prototype.setPixel=function(t,i,e){if(t>=0&&t<this._width&&i>=0&&i<this._height){var o=4*(t+i*this._imageData.width);this._imageData.data[o+0]=Math.round(255*e._r),this._imageData.data[o+1]=Math.round(255*e._g),this._imageData.data[o+2]=Math.round(255*e._b),this._imageData.data[o+3]=Math.round(255*e._a)}},o.prototype.drawSlantedLineUp=function(t){for(var i=this._xPos;this._xPos<i+t;)this.setPixel(this._xPos,this._yPos,this._color),this.setPixel(this._xPos+1,this._yPos,this._color),this._yPos--,this._xPos+=2},o.prototype.drawSlantedLineDown=function(t){for(var i=this._xPos;this._xPos<i+t;)this.setPixel(this._xPos,this._yPos,this._color),this.setPixel(this._xPos+1,this._yPos,this._color),this._yPos++,this._xPos+=2},o.prototype.drawVerticalLine=function(t){for(var i=this._yPos;this._yPos<i+t;)this.setPixel(this._xPos,this._yPos,this._color),this._yPos++},o.prototype.drawHorizontalLine=function(t){for(var i=this._xPos;this._xPos<i+t;)this.setPixel(this._xPos,this._yPos,this._color),this._xPos++},o.prototype.render=function(){this._context.putImageData(this._imageData,0,0)},s.prototype.getPalette=function(t){var i=t.getHash();if(!this._colorLUT[i]){var e=null;if(0!==t._a){var o=t.getHSL();e={normalSide:t,darkSide:o.darken(30).getRGB(),darkestSide:o.darken(60).getRGB(),highlight:o.lighten(30).getRGB(),cornerHighlight:o.lighten(80).getRGB(),outline:o.darken(90).getRGB()}}this._colorLUT[i]=e}return this._colorLUT[i]},t.Pixify=h}(this);